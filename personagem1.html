<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personagem 1 - RA Completa (Corrigido)</title>
    
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <!-- AR.js -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.0/aframe/build/aframe-ar.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            overflow: hidden;
        }
        
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s;
        }
        
        .loading-content {
            text-align: center;
            padding: 30px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            border: 2px solid #4285f4;
            max-width: 90%;
            width: 400px;
        }
        
        h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            color: #fdbb2d;
        }
        
        .btn {
            background: linear-gradient(to right, #1fa2ff, #12d8fa);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            margin: 20px 0;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .marker-img {
            width: 150px;
            height: 150px;
            border: 2px solid white;
            border-radius: 10px;
            margin: 15px 0;
            background: linear-gradient(45deg, #2c3e50, #4ca1af);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 5rem;
            color: white;
        }
        
        /* Pain√©is de informa√ß√£o */
        .info-panel {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 25px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            z-index: 1001;
            text-align: center;
            border: 2px solid #4285f4;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .info-panel h3 {
            color: #fdbb2d;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        .info-panel p {
            line-height: 1.6;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }
        
        .close-btn {
            background: linear-gradient(to right, #ff6b6b, #ff4444);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 0, 0, 0.3);
        }
        
        /* Status de erro */
        .error-status {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid #ff4444;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }
        
        /* Ajustes para a cena AR */
        a-scene {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 900;
        }
        
        /* Instru√ß√µes */
        .instructions {
            margin: 20px 0;
            line-height: 1.6;
            font-size: 1.1rem;
        }
        
        /* Rodap√© */
        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.7);
            font-size: 0.9rem;
            z-index: 950;
        }
    </style>
</head>
<body>

<div id="loading">
    <div class="loading-content">
        <h2>üéÆ REALIDADE AUMENTADA</h2>
        
        <div class="error-status">
            <strong>Status:</strong> Aguardando inicializa√ß√£o da c√¢mera
        </div>
        
        <div class="instructions">
            <p>Mostre o marcador Hiro para a c√¢mera quando solicitado</p>
        </div>
        
        <div class="marker-img">H</div>
        
        <button class="btn" id="start-button">üì∑ INICIAR C√ÇMERA</button>
        
        <p>Certifique-se de permitir o acesso √† sua c√¢mera</p>
    </div>
</div>

<!-- Cena AR -->
<a-scene 
    vr-mode-ui="enabled: false"
    arjs="sourceType: webcam; debugUIEnabled: false;"
    renderer="logarithmicDepthBuffer: true;"
    embedded
    style="display: none;"
    id="ar-scene"
>
    
    <!-- Marcador HIRO -->
    <a-marker preset="hiro" id="marker">
        
        <!-- Imagem do Personagem - ROTA√á√ÉO CORRIGIDA -->
        <a-image 
            src="https://cdn.glitch.global/6d5dff6f-2e4f-4d34-8f5c-5ff5c63c7c3e/image1.png?v=1739221063714" 
            position="0 0.5 0" 
            width="1.2" 
            height="1.6"
            rotation="0 180 0"
            material="transparent: true; alphaTest: 0.5"
        ></a-image>
        
        <!-- BOT√ïES DISTRIBU√çDOS -->
        <!-- Bot√£o Hist√≥ria -->
        <a-circle 
            position="0.6 0.3 0.1" 
            radius="0.15" 
            color="#FF6B6B"
            material="shader: flat; opacity: 0.9"
            class="ar-button"
            events="click: function() { showInfo('historia'); }"
            animation="property: scale; from: 1 1 1; to: 1.2 1.2 1; dur: 1000; loop: true; dir: alternate"
        >
            <a-text 
                value="üìñ" 
                position="0 0 0.01" 
                align="center" 
                scale="2 2 1"
                color="#FFFFFF"
            ></a-text>
        </a-circle>
        
        <!-- Bot√£o Idade -->
        <a-circle 
            position="0.6 -0.1 0.1" 
            radius="0.15" 
            color="#4ECDC4"
            material="shader: flat; opacity: 0.9"
            class="ar-button"
            events="click: function() { showInfo('idade'); }"
            animation="property: scale; from: 1 1 1; to: 1.2 1.2 1; dur: 1000; loop: true; dir: alternate; delay: 200"
        >
            <a-text 
                value="üéÇ" 
                position="0 0 0.01" 
                align="center" 
                scale="2 2 1"
                color="#FFFFFF"
            ></a-text>
        </a-circle>
        
        <!-- Bot√£o Habilidade -->
        <a-circle 
            position="0.6 -0.5 0.1" 
            radius="0.15" 
            color="#45B7D1"
            material="shader: flat; opacity: 0.9"
            class="ar-button"
            events="click: function() { showInfo('habilidade'); }"
            animation="property: scale; from: 1 1 1; to: 1.2 1.2 1; dur: 1000; loop: true; dir: alternate; delay: 400"
        >
            <a-text 
                value="‚ö°" 
                position="0 0 0.01" 
                align="center" 
                scale="2 2 1"
                color="#FFFFFF"
            ></a-text>
        </a-circle>
        
    </a-marker>
    
    <a-entity camera></a-entity>
    
</a-scene>

<!-- Pain√©is de Informa√ß√£o -->
<div id="historia" class="info-panel">
    <h3>üìñ HIST√ìRIA</h3>
    <p>L√∫cio aprendeu a arte da invisibilidade para proteger seus amigos e familiares dos perigos da cidade.</p>
    <button class="close-btn" onclick="hideInfo()">FECHAR</button>
</div>

<div id="idade" class="info-panel">
    <h3>üéÇ IDADE</h3>
    <p>18 anos</p>
    <button class="close-btn" onclick="hideInfo()">FECHAR</button>
</div>

<div id="habilidade" class="info-panel">
    <h3>‚ö° HABILIDADE</h3>
    <p>Invisibilidade Total - Pode ficar invis√≠vel por at√© 10 minutos</p>
    <button class="close-btn" onclick="hideInfo()">FECHAR</button>
</div>

<div class="footer">
    Sistema de Realidade Aumentada | Personagem: L√∫cio | Marcador: Hiro
</div>

<script>
// Aguarda o carregamento completo do DOM antes de executar o c√≥digo
document.addEventListener('DOMContentLoaded', function() {
    // Elementos - usando seletores mais espec√≠ficos para evitar null
    const loading = document.getElementById('loading');
    const arScene = document.getElementById('ar-scene');
    const errorStatus = document.querySelector('.error-status');
    const startButton = document.getElementById('start-button');
    
    // Verifica se os elementos existem antes de adicionar event listeners
    if (startButton) {
        startButton.addEventListener('click', startAR);
    } else {
        console.error('Bot√£o de in√≠cio n√£o encontrado');
    }
    
    // Fun√ß√£o para iniciar a realidade aumentada
    async function startAR() {
        try {
            if (errorStatus) {
                errorStatus.innerHTML = '<strong>Status:</strong> Solicitando acesso √† c√¢mera...';
            }
            
            // Testar c√¢mera primeiro
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: 'environment',
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                } 
            });
            
            // Parar teste
            stream.getTracks().forEach(track => track.stop());
            
            // IniciAR AR - verifica se os elementos existem
            if (arScene && arScene.style) {
                arScene.style.display = 'block';
            }
            
            if (loading && loading.style) {
                loading.style.display = 'none';
            }
            
            // For√ßar bot√µes vis√≠veis ap√≥s carregamento
            setTimeout(forceButtonsVisible, 2000);
            
        } catch (error) {
            console.error('Erro na c√¢mera:', error);
            if (errorStatus) {
                errorStatus.innerHTML = `<strong>Erro:</strong> N√£o foi poss√≠vel acessar a c√¢mera (${error.message})`;
            }
            alert('Erro ao acessar c√¢mera. Verifique as permiss√µes do navegador.');
        }
    }

    function forceButtonsVisible() {
        const buttons = document.querySelectorAll('.ar-button');
        if (buttons && buttons.length > 0) {
            buttons.forEach(button => {
                if (button.setAttribute) {
                    button.setAttribute('opacity', '1');
                    button.setAttribute('visible', 'true');
                }
            });
            console.log('Bot√µes for√ßados a aparecer');
        } else {
            console.warn('Nenhum bot√£o AR encontrado');
        }
    }

    function showInfo(type) {
        const panel = document.getElementById(type);
        if (panel && panel.style) {
            panel.style.display = 'block';
        }
    }

    function hideInfo() {
        const panels = document.querySelectorAll('.info-panel');
        if (panels && panels.length > 0) {
            panels.forEach(panel => {
                if (panel && panel.style) {
                    panel.style.display = 'none';
                }
            });
        }
    }

    // Verificar se √© mobile e atualizar a mensagem
    if (/Android|iPhone|iPad/i.test(navigator.userAgent)) {
        setTimeout(() => {
            if (errorStatus) {
                errorStatus.innerHTML = '<strong>Dispositivo m√≥vel detectado:</strong> Clique em "Iniciar C√¢mera" quando estiver pronto';
            }
        }, 1000);
    } else if (errorStatus) {
        errorStatus.innerHTML = '<strong>Dispositivo n√£o m√≥vel:</strong> A experi√™ncia AR funciona melhor em smartphones';
    }

    // Adicionar evento para detectar quando o marcador √© encontrado
    document.addEventListener('markerFound', function() {
        console.log('Marcador Hiro detectado!');
        if (errorStatus) {
            errorStatus.innerHTML = '<strong>Status:</strong> Marcador detectado com sucesso!';
        }
    });

    // Adicionar evento para detectar quando o marcador √© perdido
    document.addEventListener('markerLost', function() {
        console.log('Marcador Hiro perdido!');
        if (errorStatus) {
            errorStatus.innerHTML = '<strong>Status:</strong> Aguardando detec√ß√£o do marcador Hiro...';
        }
    });

    // Verificar se h√° erros na cena
    if (arScene) {
        arScene.addEventListener('loaded', function() {
            console.log('Cena AR carregada com sucesso');
        });

        arScene.addEventListener('error', function(e) {
            console.error('Erro na cena AR:', e);
            if (errorStatus) {
                errorStatus.innerHTML = '<strong>Erro:</strong> Falha ao carregar a cena de realidade aumentada';
            }
        });
    }
});
</script>

</body>
</html>
