<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Personagem 1 - L√∫cio</title>
    
    <!-- Pr√©-carregar tudo -->
    <link rel="preload" href="https://aframe.io/releases/1.5.0/aframe.min.js" as="script">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/mind-ar@1.2.3/dist/mindar-image-aframe.prod.js" as="script">
    <link rel="preload" href="imagens/image1.png" as="image">
    
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.3/dist/mindar-image-aframe.prod.js"></script>
    
    <style>
        body { 
            margin: 0; 
            padding: 0;
            overflow: hidden;
            background: #000;
            font-family: Arial, sans-serif;
        }
        
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            text-align: center;
            z-index: 10000;
        }
        
        .permission-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 18px;
            margin-top: 20px;
            cursor: pointer;
        }
        
        #a-scene {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <h2>üîÑ Carregando Realidade Aumentada</h2>
        <p>Permita o acesso √† c√¢mera quando solicitado</p>
        <button class="permission-btn" onclick="initAR()">Ativar C√¢mera</button>
    </div>

    <div id="a-scene"></div>

    <script>
        let arScene = null;
        
        function initAR() {
            document.getElementById('loading').innerHTML = '<h2>üì∑ Ativando c√¢mera...</h2>';
            
            // Criar cena programaticamente
            arScene = document.createElement('a-scene');
            arScene.setAttribute('mindar-image', 'imageTargetSrc: imagens/image1.png; autoStart: true;');
            arScene.setAttribute('embedded', '');
            arScene.setAttribute('color-space', 'sRGB');
            arScene.setAttribute('renderer', 'colorManagement: true; precision: low;');
            arScene.setAttribute('vr-mode-ui', 'enabled: false');
            
            // Assets
            const assets = document.createElement('a-assets');
            const img = document.createElement('img');
            img.setAttribute('id', 'card1');
            img.setAttribute('src', 'imagens/image1.png');
            assets.appendChild(img);
            
            // Camera
            const camera = document.createElement('a-camera');
            camera.setAttribute('active', 'true');
            camera.setAttribute('position', '0 0 0');
            camera.setAttribute('look-controls', 'enabled: false');
            
            // Entity
            const entity = document.createElement('a-entity');
            entity.setAttribute('mindar-image-target', 'targetIndex: 0');
            
            const image = document.createElement('a-image');
            image.setAttribute('src', '#card1');
            image.setAttribute('position', '0 0 0');
            image.setAttribute('scale', '0.3 0.4 1');
            
            entity.appendChild(image);
            arScene.appendChild(assets);
            arScene.appendChild(camera);
            arScene.appendChild(entity);
            
            document.getElementById('a-scene').appendChild(arScene);
            
            // Event listeners
            arScene.addEventListener('loaded', function() {
                document.getElementById('loading').style.display = 'none';
                console.log('‚úÖ RA Carregada!');
            });
            
            arScene.addEventListener('error', function(e) {
                console.error('‚ùå Erro:', e);
                document.getElementById('loading').innerHTML = 
                    '<h2>‚ùå Erro ao carregar</h2><p>Recarregue a p√°gina</p>';
            });
        }
        
        // Iniciar automaticamente se j√° tem permiss√£o
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(() => initAR())
                .catch(() => console.log('Aguardando permiss√£o...'));
        }
    </script>
</body>
</html>
